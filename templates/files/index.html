{% extends "files/base.html" %}
{% load static %}

{% block title %}我的代码{% endblock title %}

{% block content %}
  <iframe id='frameFile' name='frameFile' style='display: none;'></iframe>
  <form id= "uploadForm" enctype="multipart/form-data">
    <p >指定文件名： <input type="text" name="filename" value= ""/></p >
    <p >上传文件： <input type="file" name="file"/></ p>
    <input type="button" value="上传" onclick="doUpload()" />
  </form>
<jsp:include page="/static/footer.jsp"/>
<script type="text/javascript">
    function getRequestUrl() {
        var strFullPath = window.document.location.href;
        var strPath = window.document.location.pathname;
        var pos = strFullPath.indexOf(strPath);
        var prePath = strFullPath.substring(0, pos);
        var postPath = strPath.substring(0, strPath.substr(1).indexOf('/') + 1);
        var path = prePath + postPath;
        return path;
    }
    function doUpload() {
        var formData = new FormData($( "#uploadForm" )[0]);
        formData.append("CODE","123456");  //自定义参数传递
        window.alert(getRequestUrl());
        $.ajax({
            url: getRequestUrl() + "/testUpLoadForm",
            type: 'POST',
            data: formData,
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                alert(data);
            },
            error: function (data) {
                alert(data);
            }
        });
    }
</script>
 <div><a style="color:white" class="fr loginbtn" href="{% url 'users:login' %}">上传代码</a></div>
    <div>代码列表</div>
    <br>
    <div>
        {% if file_list %}
            <ul>
            {% for file in file_list %}
                <a href="file_show/{{ file.id }}">{{ file.filename }}</a>
                <div>代码描述：{{file.description}}</div>
                <div>
                    <span>上传时间：{{ file.upload_time }}</span>
                    <span>审核情况：{{ file.checked }}</span>
                </div>
                <br>
            {% endfor %}
            </ul>
        {% else %}
            <p>还没有上传代码</p>
        {% endif %}
    </div>
{% endblock content %}